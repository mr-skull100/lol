<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student ID Card Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    canvas { image-rendering: crisp-edges; image-rendering: -webkit-optimize-contrast; }
    input[type="file"] { display: none; }
  </style>
</head>
<body class="min-h-screen bg-gray-100 text-gray-800">
  <div class="max-w-7xl mx-auto p-6">
    <header class="mb-6 flex items-center justify-between">
      <h1 class="text-2xl font-bold tracking-tight">Student ID Card Generator - Spencerxd</h1>
      <p class="text-sm text-gray-500">Single-page app • HTML Canvas • Tailwind CSS</p>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Left: Form -->
      <section class="bg-white rounded-2xl shadow p-5 lg:p-6">
        <h2 class="text-lg font-semibold mb-4">Student Details</h2>
        <form id="idForm" class="space-y-4" onsubmit="event.preventDefault(); generateCard();">
          <div>
            <label for="fullName" class="block text-sm font-medium mb-1">Full Name</label>
            <input id="fullName" type="text" class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Your Name" />
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label for="memberId" class="block text-sm font-medium mb-1">Student ID</label>
              <input id="memberId" type="text" class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="ID-0000" />
            </div>
            <div>
              <label for="phone" class="block text-sm font-medium mb-1">Phone No.</label>
              <input id="phone" type="text" class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="0000000000" />
            </div>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label for="dob" class="block text-sm font-medium mb-1">Birth Date</label>
              <input id="dob" type="date" class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </div>
            <div>
              <label for="expiry" class="block text-sm font-medium mb-1">Expiry Date</label>
              <input id="expiry" type="date" class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </div>
          </div>
          <div>
            <span class="block text-sm font-medium mb-1">Student Photo</span>
            <label for="photoInput" class="inline-flex items-center gap-2 rounded-xl border border-gray-300 px-4 py-2 cursor-pointer hover:bg-gray-50">Upload Photo</label>
            <input id="photoInput" type="file" accept="image/*" />
            <span id="photoFilename" class="text-sm ml-2"></span>
          </div>
          <div class="flex flex-wrap gap-3 pt-2">
            <button type="button" onclick="generateCard()" class="rounded-xl bg-indigo-600 text-white px-4 py-2 font-medium hover:bg-indigo-700">Generate ID Card</button>
            <button id="downloadBtn" type="button" class="hidden rounded-xl border border-indigo-600 text-indigo-700 px-4 py-2 font-medium hover:bg-indigo-50" onclick="downloadCard()">Download Card (PNG)</button>
          </div>
          <p class="text-xs text-gray-500">Tip: Alt + Click on the preview canvas to print exact coordinates for perfect alignment.</p>
        </form>
      </section>

      <!-- Right: Live Preview -->
      <section class="bg-white rounded-2xl shadow p-5 lg:p-6 flex flex-col">
        <h2 class="text-lg font-semibold">Live Preview</h2>
        <div class="mt-4 flex-1 grid place-items-center">
          <canvas id="cardCanvas" class="max-w-full h-auto rounded-xl border border-gray-200 shadow-inner bg-gray-50"></canvas>
        </div>
      </section>
    </div>
  </div>

  <!-- Replace src with your new INGOUDE template filename placed next to this HTML -->
  <img id="templateImage" alt="ID Card Template" class="hidden" src="idcard.jpg" />

  <script>
    // ---------- Utilities ----------
    function roundRect(ctx, x, y, w, h, r){
      const rad = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x + rad, y);
      ctx.arcTo(x + w, y, x + w, y + h, rad);
      ctx.arcTo(x + w, y + h, x, y + h, rad);
      ctx.arcTo(x, y + h, x, y, rad);
      ctx.arcTo(x, y, x + w, y, rad);
      ctx.closePath();
    }
    function drawImageCover(ctx, img, dx, dy, dW, dH){
      const sW = img.naturalWidth, sH = img.naturalHeight;
      const sR = sW / sH, dR = dW / dH;
      let sx, sy, sw, sh;
      if (sR > dR){ sh = sH; sw = sh * dR; sx = (sW - sw)/2; sy = 0; }
      else { sw = sW; sh = sw / dR; sx = 0; sy = (sH - sh)/2; }
      ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dW, dH);
    }

    // ---------- Elements ----------
    const canvas = document.getElementById('cardCanvas');
    const ctx = canvas.getContext('2d');
    const templateImg = document.getElementById('templateImage');

    const fullNameEl = document.getElementById('fullName');
    const memberIdEl = document.getElementById('memberId');
    const phoneEl = document.getElementById('phone');
    const dobEl = document.getElementById('dob');
    const expiryEl = document.getElementById('expiry');
    const photoInputEl = document.getElementById('photoInput');
    const photoFilenameEl = document.getElementById('photoFilename');
    const downloadBtn = document.getElementById('downloadBtn');

    // ---------- Layout tuned for your INGOUDE template ----------
    // Percent values so it works across different pixel sizes of the same template.
    const LAYOUT = {
      photoPct:   { x: 0.110, y: 0.365, w: 0.300, h: 0.460, radius: 0.025 },
      namePct:    { x: 0.580, y: 0.435 },
      studentPct: { x: 0.630, y: 0.510 },
      birthPct:   { x: 0.625, y: 0.585 },
      expiryPct:  { x: 0.640, y: 0.655 },
      phonePct:   { x: 0.620, y: 0.730 }
    };
    function pxFromPct(obj){
      return {
        x: obj.x * canvas.width,
        y: obj.y * canvas.height,
        w: (obj.w ?? 0) * canvas.width,
        h: (obj.h ?? 0) * canvas.height,
        radius: (obj.radius ?? 0) * canvas.width
      };
    }

    let uploadedPhoto = null;

    templateImg.onload = () => {
      canvas.width = templateImg.naturalWidth;
      canvas.height = templateImg.naturalHeight;
      draw();
    };

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(templateImg, 0, 0, canvas.width, canvas.height);

      // Photo clipped to rounded rect so ANY aspect ratio fits the frame neatly
      const P = pxFromPct(LAYOUT.photoPct);
      ctx.save();
      roundRect(ctx, P.x, P.y, P.w, P.h, P.radius);
      ctx.clip();
      if (uploadedPhoto) drawImageCover(ctx, uploadedPhoto, P.x, P.y, P.w, P.h);
      ctx.restore();

      // Draw text values next to the printed labels on the template
      const name    = fullNameEl.value.trim() || '';
      const student = memberIdEl.value.trim() || '';
      const birth   = dobEl.value ? new Date(dobEl.value).toLocaleDateString() : '';
      const expiry  = expiryEl.value ? new Date(expiryEl.value).toLocaleDateString() : '';
      const phone   = phoneEl.value.trim() || '';

      ctx.fillStyle = '#0b1a3a';
      ctx.textBaseline = 'alphabetic';

      // Name (slightly bigger)
      ctx.font = `${Math.round(canvas.height*0.040)}px Arial, sans-serif`;
      const NP = pxFromPct(LAYOUT.namePct);
      if (name) ctx.fillText(name, NP.x, NP.y);

      // Other lines
      ctx.font = `${Math.round(canvas.height*0.034)}px Arial, sans-serif`;
      const SP = pxFromPct(LAYOUT.studentPct); if (student) ctx.fillText(student, SP.x, SP.y);
      const BP = pxFromPct(LAYOUT.birthPct);   if (birth)   ctx.fillText(birth,   BP.x, BP.y);
      const EP = pxFromPct(LAYOUT.expiryPct);  if (expiry)  ctx.fillText(expiry,  EP.x, EP.y);
      const PP = pxFromPct(LAYOUT.phonePct);   if (phone)   ctx.fillText(phone,   PP.x, PP.y);

      downloadBtn.classList.remove('hidden');
    }

    function generateCard(){ draw(); }
    function downloadCard(){
      const a = document.createElement('a');
      a.href = canvas.toDataURL('image/png');
      a.download = 'student-id-card.png';
      document.body.appendChild(a); a.click(); a.remove();
    }

    // Photo upload
    photoInputEl.addEventListener('change', (e)=>{
      const file = e.target.files?.[0]; if (!file) return;
      photoFilenameEl.textContent = file.name;
      const reader = new FileReader();
      reader.onload = ()=>{ const img = new Image(); img.onload = ()=>{ uploadedPhoto = img; draw(); }; img.src = reader.result; };
      reader.readAsDataURL(file);
    });

    // Live preview while typing
    let t; [fullNameEl, memberIdEl, phoneEl, dobEl, expiryEl].forEach(el=>{
      el.addEventListener('input', ()=>{ clearTimeout(t); t = setTimeout(draw, 200); });
    });

    // ALT + Click to log coordinates (for fine-tuning positions)
    canvas.addEventListener('click', (e)=>{
      if (!e.altKey) return;
      const r = canvas.getBoundingClientRect();
      const x = Math.round((e.clientX - r.left) * (canvas.width / r.width));
      const y = Math.round((e.clientY - r.top) * (canvas.height / r.height));
      const xPct = +(x/canvas.width).toFixed(4);
      const yPct = +(y/canvas.height).toFixed(4);
      console.log(`Canvas click → x:${x} y:${y} | xPct:${xPct} yPct:${yPct}`);
    });
  </script>
</body>
</html>

